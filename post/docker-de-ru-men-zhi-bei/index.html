<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Docker 的入门「指北」 | Hwang&#39;s Blog</title>
<meta name="description" content="欢迎来到 Hwang 的小博客 <br>
<span style="font-size:8px">
📚 博客通过 Gridea 搭建，感谢 Gridea 的免费服务；蹭在 Github，感谢 Github.com 提供的服务器资源  <br>
✏️ 文章由 Hwang，在 Ulysses 上完成写作/亦或者拷贝<br>
👨‍🎨 封面由 Hwang，在 Figma 上完成创作 <br>
这里显然不是什么技术博客，也不会有太多值得期待的干货。
</span>" />
<link rel="shortcut icon" href="https://hwang.top/favicon.ico?v=1582083585146">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://hwang.top/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://hwang.top">
  <img class="avatar" src="https://hwang.top/images/avatar.png?v=1582083585146" alt="">
  </a>
  <h1 class="site-title">
    Hwang&#39;s Blog
  </h1>
  <p class="site-description">
    欢迎来到 Hwang 的小博客 <br>
<span style="font-size:8px">
📚 博客通过 Gridea 搭建，感谢 Gridea 的免费服务；蹭在 Github，感谢 Github.com 提供的服务器资源  <br>
✏️ 文章由 Hwang，在 Ulysses 上完成写作/亦或者拷贝<br>
👨‍🎨 封面由 Hwang，在 Figma 上完成创作 <br>
这里显然不是什么技术博客，也不会有太多值得期待的干货。
</span>
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Docker 的入门「指北」
            </h2>
            <div class="post-info">
              <span>
                2019-10-07
              </span>
              <span>
                9 min read
              </span>
              
                <a href="https://hwang.top/tag/wJNvGSVZG" class="post-tag">
                  # docker
                </a>
              
                <a href="https://hwang.top/tag/AMJH5xgec" class="post-tag">
                  # 少数派
                </a>
              
                <a href="https://hwang.top/tag/CjydnGrXlu" class="post-tag">
                  # 长文
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://hwang.top/post-images/docker-de-ru-men-zhi-bei.png" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <blockquote>
<p>本文以发布于少数派：https://beta.sspai.com/post/56893<br>
推荐在少数派阅读</p>
</blockquote>
<p>如果你购买过 VPS 云主机，那么或多或少，你都可能听说过 Docker。如果你从未听说过Docker，那么本文可能能够为你开启新世界。</p>
<!-- more -->
<p>利用Docker，你能够哦非常轻松的部署各类服务，无论是个人云盘（<a href="https://sspai.com/post/55217">Nextcloud：打造属于自己的网盘服务 Docker 版(附带视频</a>）、个人的RSS服务（<a href="https://sspai.com/post/53072">利用 Docker 搭建 Tiny Tiny RSS 服务</a>）、HomeKit 桥接（<a href="https://sspai.com/post/53071">利用 Docker 搭建 HomeKit 智能家居</a>），亦或者搭建一个个人博客（<a href="https://sspai.com/post/36751">使用 Docker 部署 Ghost 教程</a>），甚至是做一个自己的维基百科、自己的社交软件，都能够轻松的实现。</p>
<p>是的，Docker 就好像是 服务器端的「应用商店」，你能够通过Docker，轻松的部署各种属于个人、团队的服务。而现如今，无论是利用各个平台的云主机，还是 树莓派、群晖、威联通等这些物理的服务器主机，甚至是自己废旧的老电脑，都能够很容易的使用上 Docker。</p>
<p>在正式开启前，本文默认读者了解基本的命令行操作，以及了解基本的Linux相关知识，如果您还不了解这些，可以通过 B站 这个 UP 主的视频有所了解：<a href="https://www.bilibili.com/video/av56233347">https://www.bilibili.com/video/av56233347</a></p>
<h2 id="那么开启-docker-之旅吧">那么开启 Docker 之旅吧！</h2>
<p>Docker 可以理解为寄存在主机上的特殊的虚拟机。它利用特殊的虚拟化技术，比一般的虚拟化技术能够更加高效合理的利用资源。一台主机上可以创建众多的容器，这些容器通过特定的方式与主机共享硬件资源，并且访问特定的文件，使用特定的端口。通过 Docker ，一台主机能够运行多种不同的服务。</p>
<h3 id="第一步安装或者启用-docker">第一步，安装或者启用 Docker</h3>
<p>一般来说，Docker 会运行在 Linux 服务器上，无论是哪种发行版本，你都可以非常容易的在搜索引擎中找到其他平台的安装方法。这里我以 Ubuntu 为例：</p>
<pre><code class="language-bash">$ sudo apt update # 先更行一下软件包缓存
$ sudo apt install docker-ce # ce 代表社区版
</code></pre>
<p>接着启动 Docker 服务</p>
<pre><code class="language-bash">$ sudo systemctl enable docker
$ sudo systemctl start docker
</code></pre>
<p>这样，你就可以尝试一下运行 <code>docker</code> 命令了</p>
<pre><code class="language-bash">$ sudo docker run hello-world
</code></pre>
<blockquote>
<p>默认情况下，docker 命令需要使用 <code>root</code> 用户或者在<code>docker</code>组下的用户才能使用（<code>docker</code> 命令会使用 <a href="https://en.wikipedia.org/wiki/Unix_domain_socket">Unix socket</a> 与 Docker 引擎通讯）。也就是说，如果不设置，默认情况下，所有的 <code>docker</code> 命令都需要加 <code>sudo</code>。<br>
一般情况下，你可以创建一个名为  <code>docker</code> 的用户组，再将当前用户加入到 <code>docker</code> 组中，使得操作更为安全。</p>
</blockquote>
<blockquote>
<pre><code class="language-bash">$ sudo groupadd docker #创建 Docker 组。
$ sudo usermod -aG docker $USER #添加当前用户到 docker 用户组中，也可将 $USER 替换为你想加入到 docker 组中的用户。
</code></pre>
</blockquote>
<h3 id="第二步拉取你的第一个-image">第二步，拉取你的第一个 Image</h3>
<p>其实你可以这么理解 Docker，你可以在一个名为 <a href="https://hub.docker.com/">Docker Hub</a> 的网站中，查找Docker 镜像（image），这个过程就好像是在 App Store 中搜索自己需要下载的应用一样。查找完想要下载的镜像后，在终端中输入：</p>
<pre><code class="language-bash">$ docker pull [镜像名称]
</code></pre>
<p>可以拉取镜像的到本地。是的，你就下载了这个应用，只不过是在服务端。当然，一般来说这个过程会比较缓慢，你可以<a href="https://yeasy.gitbooks.io/docker_practice/content/install/mirror.html">替换国内源</a>加速这一过程。</p>
<h3 id="第三步启动你的服务">第三步，启动你的服务</h3>
<p>与一般应用下载打开不同，Docker 的镜像可以重复的被打开成不同的容器。你可以简单的理解为这是「应用双开」，或者说是「应用多开」。我们使用 <code>docker run</code> 命令来启动容器。</p>
<p>这个启动的过程可以是一次性的启动，即直接使用 <code>docker run</code> + 一些列参数的方式启动服务，也可以通过 <code>docker compose</code> 来编排你的项目。由于 compose 会相对专业，本文就不做过多的介绍了，这里只以 <code>docker run</code> 为例作为讲解，以下是常见的参数：</p>
<ol>
<li><code>-d</code> ：正常情况下，启动一个服务区，我们都会让其在后台运行，所以使用参数 <code>-d</code> 来告诉 Docker，在后台默默奉献即可。</li>
<li><code>--name=</code> ：前面已经提到了，你可以对一个 Docker 镜像进行多开操作，所以通过 <code>dockr run -d --name=[你的名字]</code> 的方式，可以指定开启的这个容器的名称，这样在多开的情况下，能够更为方便的进行管理。</li>
<li><code>-p</code> : 指定端口的映射。</li>
</ol>
<p>这里简单讲解一下端口的含义：以用户输入在浏览器中输入<code>www.sspai.com</code> 为例，首先浏览器会通过 DNS 服务器把这个 Url 翻译为 IP 地址，再通过 IP 地址，找到少数派的服务器，再通过端口号确定开启的服务，例如如果你输入的是：<code>https:\\www.sspai.com</code>，那么对应的端口就是 443。端口号就相当于服务器的柜台，同个服务区会有多个柜台提供服务。诸如 <code>http</code> 服务，默认是 <code>80</code> 端口， <code>https</code> 默认是 <code>443</code> 端口，类似的 <code>FTP</code> 服务是 <code>21</code> 等等。 并且<strong>一个端口只能支持一个服务，就是说一个柜台只支持办理一项服务</strong>。</p>
<p>回到 <code>-p</code> 这个参数，<code>-p 8080:80</code> 就是指将 docker 中开启的端口，映射到主机的 <code>8080</code> 端口中。也就是说通过主机的IP地址的<code>8080</code> 端口，可以访问到 docker 容器的<code>80</code> 端口服务。 服务器的 <code>8080</code> 柜台接收到的服务，会发送到容器的<code>80</code>柜台中。是的，容器也相当于是一个服务器，在 Docker 内部，他们之间也是有 IP 地址的说法的，所以容器也是需要开「柜台」来管理服务的。</p>
<p>理解这一步非常重要，和一般的使用应用不同，服务器上的应用就是一直在运行，然后让你去访问的，所以 <code>-p</code> 参数设置不对，可就找不到柜台办理正确的服务器了。例如运行：</p>
<pre><code class="language-bash">$ docker run -d --name=nextcloud_demo -p 8080:80 nextcloud
</code></pre>
<p>那么你可以通过 <code>http://localhost:8080</code> 访问到你的 nextcloud 服务。这里的 <code>loaclhost</code> 指的是在 Docker 服务器上访问。如果你想通过自己的电脑，访问 Docker 服务器上的服务，把 <code>loaclhost</code> 替换为服务器的 IP 地址即可。</p>
<ol start="4">
<li><code>-v</code> ：建立主机于docker容器内的文件关联。通过<code>-v</code> 能够 主机的文件映射到 docker 容器中，例如：</li>
</ol>
<pre><code class="language-bash">$ docker run -d \
-v nextcloud:/var/www/html \
nextcloud
</code></pre>
<p>就是将本地本地文件夹 <code>nextcloud</code> 映射到容器中的 <code>/var/www/html</code> 目录。</p>
<p>这 4 个参数就是docker 最基础也是最常用的参数了。了解了这四个参数，再参照 Docker Hub 下每一个镜像的使用说明，你就可以尽情的拥抱和享受开源社区的各种服务了。</p>
<h2 id="推荐一些好用的-docker-镜像">推荐一些好用的 Docker 镜像</h2>
<p>除了开篇提到的 NextCloud、Tiny Tiny RSS、Ghost 等服务外，还有一些镜像值得尝试：</p>
<ol>
<li><a href="https://hub.docker.com/_/mediawiki">MediaWiki</a>： 和维基百科一样的属于个人或者团队的维基服务。</li>
<li><a href="https://hub.docker.com/r/wekanteam/wekan">Wekan</a>：属于个人或者团队的开源看板应用。参考Trello等服务。</li>
<li><a href="https://hub.docker.com/_/wordpress">WordPress</a>：为人所知的、被广泛使用的、收购了tumblr的博客服务，可以用来搭建个人博客，甚至商用网站。</li>
<li>gitlab、gitea 等 Git 服务：如果有团队代码管理需求，可以使用 Docker 快速部署一个私用的 Git 服务。</li>
</ol>
<h2 id="部署一时爽运维火葬厂">部署一时爽，运维「火葬厂」</h2>
<p>Docker 让服务的安装变得异常容易，但是选择一项服务后，后面的运维才是真正折腾人的地方。</p>
<p>首先是管理容器中，最常使用到：</p>
<pre><code class="language-bash">$ docker ps #查看运行中的容器。
$ docker ps -a #查看所有容器，包括停止的。
$ docker images #查看安裝的镜像
</code></pre>
<p>然后是停止、启动已有的容器：</p>
<pre><code class="language-bash">$ docker stop &lt;容器名称/ID&gt; # 正常停止容器
$ docker start &lt;容器名称/ID&gt; # 启动已有容器
$ docker kill &lt;容器名称/ID&gt; # 强制停止容器
</code></pre>
<p>一般容器运行后，会有一个 ID，用以区分容器，这个ID 一般都是乱序的，所以之前的 <code>--name</code> 参数，能够使你更加方便对容器进行管理。</p>
<p>除此之外，还有就是进入 Docker 容器中，修改一些配置文件：</p>
<pre><code class="language-bash">$ sudo docker exec -it &lt;容器名称/ID&gt; /bin/bash
</code></pre>
<p>就是说你可以通过这个命令，进入到 容器的 <code>bash</code> 中，对容器内进行一些修改。</p>
<p>最后 docker 还有许多其他的命令和方法可供学习。作为当今最受欢迎的容器化解决方案，docker 在业界发光发亮的同时，也为一般用户，「一键」启用某些服务提供了契机。利用开源社区，你可以比以往任何时候都更为容易的实现许多互联网服务的「自给自足」。</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E9%82%A3%E4%B9%88%E5%BC%80%E5%90%AF-docker-%E4%B9%8B%E6%97%85%E5%90%A7">那么开启 Docker 之旅吧！</a>
<ul>
<li><a href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%AE%89%E8%A3%85%E6%88%96%E8%80%85%E5%90%AF%E7%94%A8-docker">第一步，安装或者启用 Docker</a></li>
<li><a href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E6%8B%89%E5%8F%96%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA-image">第二步，拉取你的第一个 Image</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%E5%90%AF%E5%8A%A8%E4%BD%A0%E7%9A%84%E6%9C%8D%E5%8A%A1">第三步，启动你的服务</a></li>
</ul>
</li>
<li><a href="#%E6%8E%A8%E8%8D%90%E4%B8%80%E4%BA%9B%E5%A5%BD%E7%94%A8%E7%9A%84-docker-%E9%95%9C%E5%83%8F">推荐一些好用的 Docker 镜像</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2%E4%B8%80%E6%97%B6%E7%88%BD%E8%BF%90%E7%BB%B4%E7%81%AB%E8%91%AC%E5%8E%82">部署一时爽，运维「火葬厂」</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://hwang.top/post/hwang-de-di-zhi-yue-du-dan-new-2">
              <h3 class="post-title">
                Hwang 的低质阅读单 New 2
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://hwang.top/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()

  let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

  // This should probably be throttled.
  // Especially because it triggers during smooth scrolling.
  // https://lodash.com/docs/4.17.10#throttle
  // You could do like...
  // window.addEventListener("scroll", () => {
  //    _.throttle(doThatStuff, 100);
  // });
  // Only not doing it here to keep this Pen dependency-free.

  window.addEventListener("scroll", event => {
    let fromTop = window.scrollY;

    mainNavLinks.forEach((link, index) => {
      let section = document.getElementById(decodeURI(link.hash).substring(1));
      let nextSection = null
      if (mainNavLinks[index + 1]) {
        nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
      }
      console.log('section.offsetHeight', section.offsetHeight);
      if (section.offsetTop <= fromTop) {
        if (nextSection) {
          if (nextSection.offsetTop > fromTop) {
            link.classList.add("current");
          } else {
            link.classList.remove("current");    
          }
        } else {
          link.classList.add("current");
        }
      } else {
        link.classList.remove("current");
      }
    });
  });

</script>

      </div>
    </div>
  </body>
</html>
