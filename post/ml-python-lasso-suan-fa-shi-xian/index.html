<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ML - Python LASSO ç®—æ³•å®ç° | Hwang&#39;s Blog</title>
<meta name="description" content="æ¬¢è¿æ¥åˆ° Hwang çš„å°åšå®¢ <br>
ğŸ“š åšå®¢é€šè¿‡ Gridea æ­å»ºï¼Œæ„Ÿè°¢ Gridea çš„å…è´¹æœåŠ¡ï¼›è¹­åœ¨ Githubï¼Œæ„Ÿè°¢ Github.com æä¾›çš„æœåŠ¡å™¨èµ„æº  <br>
âœï¸ æ–‡ç« ç”± Hwangï¼Œåœ¨ Ulysses ä¸Šå®Œæˆå†™ä½œ/äº¦æˆ–è€…æ‹·è´<br>
ğŸ‘¨â€ğŸ¨ å°é¢ç”± Hwangï¼Œåœ¨ Figma ä¸Šå®Œæˆåˆ›ä½œ <br>
è¿™é‡Œæ˜¾ç„¶ä¸æ˜¯ä»€ä¹ˆæŠ€æœ¯åšå®¢ï¼Œä¹Ÿä¸ä¼šæœ‰å¤ªå¤šå€¼å¾—æœŸå¾…çš„å¹²è´§ã€‚" />
<link rel="shortcut icon" href="https://hwang.top/favicon.ico?v=1582702496166">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://hwang.top/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://hwang.top">
  <img class="avatar" src="https://hwang.top/images/avatar.png?v=1582702496166" alt="">
  </a>
  <h1 class="site-title">
    Hwang&#39;s Blog
  </h1>
  <p class="site-description">
    æ¬¢è¿æ¥åˆ° Hwang çš„å°åšå®¢ <br>
ğŸ“š åšå®¢é€šè¿‡ Gridea æ­å»ºï¼Œæ„Ÿè°¢ Gridea çš„å…è´¹æœåŠ¡ï¼›è¹­åœ¨ Githubï¼Œæ„Ÿè°¢ Github.com æä¾›çš„æœåŠ¡å™¨èµ„æº  <br>
âœï¸ æ–‡ç« ç”± Hwangï¼Œåœ¨ Ulysses ä¸Šå®Œæˆå†™ä½œ/äº¦æˆ–è€…æ‹·è´<br>
ğŸ‘¨â€ğŸ¨ å°é¢ç”± Hwangï¼Œåœ¨ Figma ä¸Šå®Œæˆåˆ›ä½œ <br>
è¿™é‡Œæ˜¾ç„¶ä¸æ˜¯ä»€ä¹ˆæŠ€æœ¯åšå®¢ï¼Œä¹Ÿä¸ä¼šæœ‰å¤ªå¤šå€¼å¾—æœŸå¾…çš„å¹²è´§ã€‚
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              ML - Python LASSO ç®—æ³•å®ç°
            </h2>
            <div class="post-info">
              <span>
                2018-07-13
              </span>
              <span>
                4 min read
              </span>
              
                <a href="https://hwang.top/tag/LgCVVhtVr/" class="post-tag">
                  # ML
                </a>
              
                <a href="https://hwang.top/tag/Zf-hLAESr/" class="post-tag">
                  # python
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://hwang.top/post-images/ml-python-lasso-suan-fa-shi-xian.png" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <pre><code class="language-python">import itertools
from math import exp
import numpy as np
import matplotlib.pyplot as plt
from numpy import *


&lt;!-- more --&gt;


## åº“å¯¼å…¥

def load_data(filename):
## åŠ è½½æ•°æ®çš„å‡½æ•°
	X, Y = [], [] ##åˆ—è¡¨å­˜å‚¨
	with open(filename, 'r') as f: #è¯»å–æ–‡ä»¶
		for line in f:
			splited_line = [float(i) for i in line.split()] #åˆ†å‰²è¡Œå‚¨å­˜åˆ° splited_line ä¸­
			x, y = splited_line[: -1], splited_line[-1] #è¯»å–ç¬¬ä¸€åˆ—å’Œç¬¬ä¸€è¡Œæ•°æ®ï¼Œå‚¨å­˜ä¸ºxï¼Œy
			X.append(x)
			Y.append(y)
	X, Y = np.matrix(X), np.matrix(Y).T
	return X, Y

####################################


def standarize(X):
# ä¸­å¿ƒåŒ– &amp; æ ‡å‡†åŒ–æ•°æ® (é›¶å‡å€¼, å•ä½æ ‡å‡†å·®)

	std_deviation = np.std(X, 0) 

# åˆ©ç”¨numpyï¼Œè®¡ç®—Xçš„æ ‡å‡†å·®ã€‚
# stdï¼ˆa, axis = Noneï¼‰ ï¼šåŒç†ï¼Œè®¡ç®—æ ‡å‡†å·®ã€‚ ä¾ç»™å®šè½´axisè®¡ç®—æ•°ç»„aç›¸å…³å…ƒç´ æ ‡å‡†å·®ï¼Œå…¶ä¸­axisä¸ºæ•´æ•°æˆ–è€…å…ƒç»„ã€‚
	
	mean = np.mean(X, 0)# å¯¹æ•°ç»„açš„ç¬¬1ç»´åº¦çš„æ•°æ®è¿›è¡Œæ±‚å¹³å‡ 
	return (X - mean)/std_deviation 


#######################################

# ä¸€èˆ¬çº¿æ€§å›å½’å‡½æ•° OLSï¼›

def std_linreg(X, Y):
	xTx = X.T*X # åˆ©ç”¨numpy åšçŸ©é˜µçš„è£…ç½®ã€‚
	if np.linalg.det(xTx) == 0:
		print('xTx is a singular matrix')
		return
	return xTx.I*X.T*Y


#######################################


def get_corrcoef(X, Y):
	# X Y çš„åæ–¹å·®
	cov = np.mean(X*Y) - np.mean(X)*np.mean(Y)
	return cov/(np.var(X)*np.var(Y))**0.5

 


#######################################


def lasso_regression(X, y, lambd=0.2, threshold=0.1):

# é€šè¿‡åæ ‡ä¸‹é™(coordinate descent)æ³•è·å–LASSOå›å½’ç³»æ•°

	# è®¡ç®—æ®‹å·®å¹³æ–¹å’Œ
	rss = lambda X, y, w: (y - X*w).T*(y - X*w)
	# åˆå§‹åŒ–å›å½’ç³»æ•°w.
	m, n = X.shape
	w = np.matrix(np.zeros((n, 1)))
	r = rss(X, y, w)
	# ä½¿ç”¨åæ ‡ä¸‹é™æ³•ä¼˜åŒ–å›å½’ç³»æ•°w
	niter = itertools.count(1)
	for it in niter:
		for k in range(n):
			# è®¡ç®—å¸¸é‡å€¼z_kå’Œp_k
			z_k = (X[:, k].T*X[:, k])[0, 0]
			p_k = 0
			for i in range(m):
				p_k += X[i, k]*(y[i, 0] - sum([X[i, j]*w[j, 0] for j in range(n) if j != k]))
			if p_k &lt; -lambd/2:
				w_k = (p_k + lambd/2)/z_k
			elif p_k &gt; lambd/2:
				w_k = (p_k - lambd/2)/z_k
			else:
				w_k = 0
			w[k, 0] = w_k
		r_prime = rss(X, y, w)
		delta = abs(r_prime - r)[0, 0]
		r = r_prime
		print('Iteration: {}, delta = {}'.format(it, delta))
		if delta &lt; threshold:
			break
	return w


##################################


# å®šä¹‰lassoç®—æ³•

def lasso_traj(X, y, ntest=30):
#  è·å–å›å½’ç³»æ•°è½¨è¿¹çŸ©é˜µ

	_, n = X.shape
	ws = np.zeros((ntest, n))
	for i in range(ntest):
		w = lasso_regression(X, y, lambd=exp(i-10))
		ws[i, :] = w.T
		print('lambda = e^({}), w = {}'.format(i-10, w.T[0, :]))
	return ws

####################################


if '__main__' == __name__: #æ¨¡å—æ˜¯å¯¹è±¡ï¼Œå¹¶ä¸”æ‰€æœ‰çš„æ¨¡å—éƒ½æœ‰ä¸€ä¸ªå†…ç½®å±æ€§ __name__ã€‚ä¸€ä¸ªæ¨¡å—çš„ __name__ çš„å€¼å–å†³äºæ‚¨å¦‚ä½•åº”ç”¨æ¨¡å—ã€‚å¦‚æœ import ä¸€ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆæ¨¡å—__name__ çš„å€¼é€šå¸¸ä¸ºæ¨¡å—æ–‡ä»¶åï¼Œä¸å¸¦è·¯å¾„æˆ–è€…æ–‡ä»¶æ‰©å±•åã€‚ä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥åƒä¸€ä¸ªæ ‡å‡†çš„ç¨‹åºæ ·ç›´æ¥è¿è¡Œæ¨¡å—ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹, __name__ çš„å€¼å°†æ˜¯ä¸€ä¸ªç‰¹åˆ«ç¼ºçœ&quot;__main__&quot;ã€‚
## https://www.zhihu.com/question/49136398


	X, y = load_data('abalone.txt')
	X, y = standarize(X), standarize(y)
	w = lasso_regression(X, y, lambd=10)
	y_prime = X*w
	## è®¡ç®—ç›¸å…³ç³»æ•°

	corrcoef = get_corrcoef(np.array(y.reshape(1, -1)),
							np.array(y_prime.reshape(1, -1)))
								## è®¡ç®—åæ–¹å·®

	print('Correlation coefficient: {}'.format(corrcoef))
	ntest = 30

	## ç»˜åˆ¶è½¨è¿¹

	ws = lasso_traj(X, y, ntest)
	fig = plt.figure()
	ax = fig.add_subplot(111)
	lambdas = [i - 10 for i in range(ntest)]
	ax.plot(lambdas, ws)
	plt.show()


</code></pre>

              </div>
              <div class="toc-container">
                
              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://hwang.top/post/2017-kai-shi-de-shu-zi-sheng-huo/">
              <h3 class="post-title">
                 2017 å¼€å§‹çš„ã€Œæ•°å­—ç”Ÿæ´»ã€
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://hwang.top/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()

  let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

  // This should probably be throttled.
  // Especially because it triggers during smooth scrolling.
  // https://lodash.com/docs/4.17.10#throttle
  // You could do like...
  // window.addEventListener("scroll", () => {
  //    _.throttle(doThatStuff, 100);
  // });
  // Only not doing it here to keep this Pen dependency-free.

  window.addEventListener("scroll", event => {
    let fromTop = window.scrollY;

    mainNavLinks.forEach((link, index) => {
      let section = document.getElementById(decodeURI(link.hash).substring(1));
      let nextSection = null
      if (mainNavLinks[index + 1]) {
        nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
      }
      console.log('section.offsetHeight', section.offsetHeight);
      if (section.offsetTop <= fromTop) {
        if (nextSection) {
          if (nextSection.offsetTop > fromTop) {
            link.classList.add("current");
          } else {
            link.classList.remove("current");    
          }
        } else {
          link.classList.add("current");
        }
      } else {
        link.classList.remove("current");
      }
    });
  });

</script>

      </div>
    </div>
  </body>
</html>
